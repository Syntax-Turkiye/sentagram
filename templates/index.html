<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SENTAGRAM</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="{{ url_for('static', filename='images/SYNTÜRK-logo-bg-removed.png') }}" alt="Syntürk Logo"
                    class="logo">
            </div>
            <h1>SENTAGRAM</h1>
            <h2>Cümleyi Ögelerine Ayırma</h2>
            <form id="sentence-form">
                <input type="text" id="sentence" name="sentence" placeholder="Cümlenizi buraya yazın">
                <button type="submit" class="submit-button">Gönder</button>
            </form>
        </div>
        <div id="result"></div>
        <div id="history"></div>
    </div>

    <script>
        document.getElementById('sentence-form').onsubmit = async (e) => {
            e.preventDefault();
            const sentence = document.getElementById('sentence').value;
            try {
                const response = await fetch('/process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `sentence=${encodeURIComponent(sentence)}`
                });
                const result = await response.json();
                if (result.error) {
                    throw new Error(result.error);
                }
                console.log("Original Result:", result);
                displayResult(sentence, result);
                addToHistory(sentence, result);
            } catch (error) {
                console.error("Error processing sentence:", error);
            }
        };

        function displayResult(sentence, mappedResult) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '';
            const table = document.createElement('table');
            const tbody = document.createElement('tbody');

            const orderedKeys = Object.keys(mappedResult).sort((a, b) => sentence.indexOf(a) - sentence.indexOf(b));
            console.log("Ordered Keys:", orderedKeys); // Loglama eklendi

            for (const word of orderedKeys) {
                const row = document.createElement('tr');
                const cellWord = document.createElement('td');
                const cellLabel = document.createElement('td');
                cellWord.innerText = word;
                cellLabel.innerText = mappedResult[word];
                row.appendChild(cellWord);
                row.appendChild(cellLabel);
                tbody.appendChild(row);
                console.log(`Display: ${word} -> ${mappedResult[word]}`);  // Loglama eklendi
            }

            table.appendChild(tbody);
            resultDiv.appendChild(table);
        }

        function addToHistory(sentence, mappedResult) {
            const history = document.getElementById('history');
            const historyItem = document.createElement('div');
            historyItem.classList.add('history-item');

            const sentenceText = document.createElement('div');
            sentenceText.classList.add('sentence-text');
            sentenceText.innerText = sentence;

            const resultTable = document.createElement('table');
            const tbody = document.createElement('tbody');

            const orderedKeys = Object.keys(mappedResult).sort((a, b) => sentence.indexOf(a) - sentence.indexOf(b));
            console.log("Ordered Keys:", orderedKeys); // Loglama eklendi

            for (const word of orderedKeys) {
                const row = document.createElement('tr');
                const cellWord = document.createElement('td');
                const cellLabel = document.createElement('td');
                cellWord.innerText = word;
                cellLabel.innerText = mappedResult[word];
                row.appendChild(cellWord);
                row.appendChild(cellLabel);
                tbody.appendChild(row);
                console.log(`History: ${word} -> ${mappedResult[word]}`);  // Loglama eklendi
            }

            resultTable.appendChild(tbody);
            historyItem.appendChild(sentenceText);
            historyItem.appendChild(resultTable);
            history.insertBefore(historyItem, history.firstChild);  // En başa ekle
        }

    </script>
</body>

</html>
